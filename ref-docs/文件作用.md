# 项目文件作用总览（注释索引）

本文档梳理 `lingo-link-rev` 的主要目录与文件职责，便于通读源码与后续维护。代码中也已按相同口径补充了头部注释与关键 JSDoc。

—

【注释风格约定】
- 文件头：简述“模块概述 / 关键点 / 对外暴露 / 依赖”。
- 函数/方法：JSDoc 注明参数、返回值与副作用（如网络、存储、事件）。
- 组件/Hook：说明交互、props 与订阅/清理逻辑。
- 不改动行为与导出，仅补充注释；生成/第三方库文件不加注释。

—

## 顶层
- `manifest.config.ts`：扩展清单的构建配置（Vite + webextension）
- `background.html`：后台页入口 HTML（部分浏览器使用）
- `vite.config.ts`：Vite 构建配置
- `tailwind.config.js` / `postcss.config.js`：样式与原子类配置
- `tsconfig*.json`：TypeScript 编译配置
- `buildExtension.sh`：打包脚本

## src（源码总览）

### 后台与脚本
- `src/background.ts`：扩展后台脚本
  - 右键菜单、消息总线、统一网络代理、截图、OAuth 等
- `src/contentScript/index.tsx`：内容脚本入口
  - 自定义元素 + Shadow DOM + React 容器，注入高亮样式，处理全屏切换
- `src/contentScript/highlightStyle.tsx`：动态生成页面高亮 CSS
- `src/contentScript/lingoCard.tsx`：页面内的主交互卡片（翻译/对话等）

### API（后端与第三方服务）
- `src/api/index.ts`：统一请求封装（token/JSON/错误处理、上传工具）
- `src/api/chat.ts`：根据引擎值返回对应聊天实现类（构造器）
- `src/api/openAI.tsx`：OpenAI Chat 实现（流式、上下文、可中断）
- `src/api/customAI.tsx`：自定义 OpenAI 兼容接口实现
- `src/api/gemini.ts`：Google Gemini 实现
- `src/api/wenxin.ts`：百度文心一言实现
- `src/api/deepSeek.tsx`：DeepSeek 实现
- `src/api/moonShot.ts`：MoonShot 实现
- `src/api/deeplx.ts`：DeepLX 句子翻译
- `src/api/google.ts`：Google 翻译（免费接口）
- `src/api/oulu.ts`：欧路词典开放平台 API（生词同步）
- `src/api/youdaoTranslate.ts`：有道翻译

### 状态与存储
- `src/store.ts`：jotai 全局原子
  - 设置（与 storage.sync 同步）、本地生词表、增删改动作
- `src/storage/local.ts`：chrome.storage.local 封装（生词表、备注、缓存模型列表）
- `src/storage/session.ts`：chrome.storage.session 封装（会话级状态，如登录弹窗）
- `src/storage/sync.ts`：chrome.storage.sync 封装（跨设备设置）

### 实用工具
- `src/utils/index.ts`：工具方法合集
  - 位置计算、background 通信、SSE 解析、图片压缩/转换、柯林斯解析等
- `src/utils/const.ts`：常量与默认设置（引擎清单、语言列表、提示词模板等）
- 其余工具：
  - `translate.ts`：翻译相关工具
  - `youdaoParser.ts` / `newYoudaoParser.ts`：有道结果解析
  - `getSelection.ts`：页面选区获取
  - `treeWalkerMark.ts`：DOM 遍历与标记
  - `pageClicked.ts` / `onCaptureScreenResult.ts`：页面交互/截图回调
  - `prompt.ts`：提示词模板
  - `mitt.ts`：事件总线

### React 组件
- 通用：
  - `Toast.tsx`：轻量通知（全局容器 + 管理器）
  - `DialogWrapper.tsx` / `ExternalLink.tsx` / `DropDown.tsx` / `EngineDropdown.tsx` 等 UI 组件
  - `ChatInput.tsx`：聊天输入框（Enter 发送，Shift+Enter 换行）
  - `Conversation.tsx` / `WordChat.tsx`：会话与词义对话视图
  - `Translate.tsx` / `SearchResult.tsx` / `Highlight.tsx`：翻译与高亮展示
  - `CollectForm.tsx` / `CollectModal.tsx` / `UpdateLog.tsx` 等
- 图标类：`SendIcon.tsx` / `TriggerIcon.tsx` / `DefaultAvator.tsx` / `Avator.tsx`
- 编辑与扩展：`Editor.tsx` / `ImgUploaderPreview.tsx` / `Speaker.tsx`

### Hook
- `useContentScriptMessage.tsx`：监听 background 消息刷新本地数据
- `useListenPostMessage.tsx`：窗口/iframe postMessage 通信相关
- `useTreeWalker.tsx`：DOM 遍历辅助

### 页面（Options / Popup）
- Options（设置页）：
  - `options.tsx`：通用设置（账号、触发图标、语言、快捷键等）
  - `enginsSetting.tsx`：引擎设置（OpenAI/Gemini/文心/DeepSeek/MoonShot/DeepLX/Custom）
  - `dataManage.tsx`：数据管理（欧路词典同步）
  - `screenshotSetting.tsx`：截图 OCR 设置（百度 OCR）
  - `wordEngine.tsx` / `sentenceEngine.tsx`：词/句引擎启用与排序
  - `externalLiks.tsx`：外部链接管理
  - `hotkeyInput.tsx`：快捷键输入组件
  - `other.tsx` / `movieWeb.tsx` / `question.tsx` / `sidebar.tsx` / `main.tsx`：其他子页与入口
- Popup（弹窗页）：
  - `main.tsx` / `footer.tsx` / `index.html`

### 类型与国际化
- `src/types/*.ts`：类型定义集合（设置、消息、词条、社区等）
- `src/i18n.ts`：i18n 初始化

### 站点注入脚本
- `src/lib/injectScripts/index.ts`：根据站点注入特定脚本/样式
- `src/lib/injectScripts/movie-web.ts` / `.css`：站点定制
- `src/lib/webcomponents-bundle.js`：自定义元素 polyfill（第三方库，未改动）

—

若需进一步细化某一模块（例如组件层级或某类引擎的完整调用链），可在 IDE 中定位到对应文件，头部注释已给出入口与交互要点。欢迎指出希望优先加细注释的文件清单。 
